# Star Sea - Development Session Memory
**Session Start:** 2025-10-02 00:00:00
**Status:** Planning Phase

## Session Overview
Beginning development of Star Sea, a top-down space combat game with mission-based branching narrative.

## Requirements Gathered (80 Questions Answered)

### Technical Specifications
- **Resolution:** 1920x1080, responsive design
- **Physics Engine:** planck.js (Box2D port)
- **Renderer:** Canvas 2D (retro vector graphics style)
- **Performance:** 60 FPS target, no max object limit
- **Platform:** Desktop only
- **Players:** Single-player only
- **Save System:** LocalStorage + downloadable JSON, mid-mission saves, 0-3 save slots based on difficulty

### Core Gameplay
- **Movement:** Newtonian (unlimited speed) & Non-Newtonian (capped speed) modes, toggle with Left Ctrl
- **Physics:** Zero friction, bounce collisions with damage, linear gravity well falloff
- **Controls:** WASD movement, mouse reticle, left-click beams, right-click torpedoes, spacebar decoys, long-press mines, ESC pause
- **Camera:** Player ship fixed in center, world scrolls around it

### Ship Types & Systems
- **Player:** Heavy Cruiser (initial), hooks for future ship selection
- **Enemies:** Frigate, Light Cruiser, Heavy Cruiser, Battle Cruiser
- **Factions:** Pirates (aggressive), Scintilians (defensive), Trigons (balanced)
- **Internal Systems:** Each ship has damageable subsystems (weapons, shields, engines, sensors, C&C, bay, power, space frame)
- **Auto-Repair:** 0.03 HP/sec per system until 0 HP (then stops)

### Weapons & Combat
- **Beams:** 20 ship-lengths range, very fast travel, 1 dmg/hit, arc-based firing, 3 shots in succession (1 sec/shot), 2 sec delay then recharges 1/3 bar per 2 sec
- **Torpedoes:** Arc-based (fore 90°, aft 90°), 6x max ship speed, 4-sec duration, homing when locked (fire-and-forget), 1 damage to shields, can be shot down
- **Lock-On:** 4 seconds to acquire, torpedo retains lock even if ship loses lock, maintains with drift tolerance
- **Decoys:** 6 per ship (Bay), 10-sec duration, 6-sec gap between releases, can confuse torps/block beams
- **Mines:** 6 per ship (Bay), invisible to enemies, 10 damage on contact, 6-sec gap between releases
- **Shields:** 4 quadrants (Fore/Port/Starboard/Aft), 5-sec recovery delay per shield after being hit, 1 HP/sec recovery, white curves when hit
- **Torpedo Reload:** Begins 4 seconds after last shot, reloads 1 torp/4 seconds until full

### Mission System
- **Total Missions:** 20
- **Progression:** Branching linear (outcomes determine next available missions)
- **Victory Conditions:** Scenario-specific (destroy targets, survive, scan, protect, etc.)
- **Special Rules:** Environmental hazards, time limits, unique objectives
- **Failure Handling:** Retry allowed, return to menu, skip after 6 failures
- **UI:** Briefing screen before, debriefing screen after

### AI Behavior
- **Detection Radii:** FG=40, CL=25, CA=30, BC=25 ship lengths
- **Patrol Mode:** When no enemies detected
- **Combat Mode:** Faction-specific tactics when enemy in radius
- **Ship Class Tactics:** Smaller ships (FG/CL) target rear arc, larger (CA/BC) prefer broadsides
- **Retreat:** Ships flee when damaged if >2x detection radius from enemies
- **Identification:** Full visibility within radius, green blob contact beyond to 2x radius
- **Targeting:** Always prioritize player ship

### Visual & Audio
- **Art Style:** Retro vector graphics with component-divided ships
- **Asteroids:** Detailed irregular shapes, break into smaller pieces
- **Effects:** Simple expanding circle explosions, particle dust clouds, swirling collapsar
- **Shields:** White curves appear on hit, fade as weakened
- **Audio:** Orchestral music (ambient space/combat switch), full SFX suite, master volume control
- **UI:** Tactical panel (top-left), minimap (top-right, 2x detection radius), visual bars

### Environmental Hazards
- **Asteroids:** Large/Medium/Small, fixed at start, detailed shapes, break on damage
- **Collapsar:** Static black hole with swirling particle gravity well, destroys on contact
- **Dust Clouds:** Static particle clouds, block beam weapons
- **Planets/Moons:** Large circles, immune to damage

## System Specifications Detail

### Heavy Cruiser (Player Starting Ship)
- **Forward Beam Battery:** 4 HP, 270° arc centered ahead, 1 dmg/hit, 3-shot burst
- **Aft Beam Battery:** 4 HP, 270° arc centered astern, 1 dmg/hit, 3-shot burst
- **Forward Torpedo Launcher:** 4 HP, 90° arc ahead, 4 loaded/20 stored, reload 1/4sec after 4-sec delay
- **Aft Torpedo Launcher:** 4 HP, 90° arc astern, 4 loaded/20 stored, reload 1/4sec after 4-sec delay
- **Fore Shield Generator:** 8 HP, powers 20 HP shield
- **Aft Shield Generator:** 8 HP, powers 10 HP shield
- **Port Shield Generator:** 8 HP, powers 15 HP shield
- **Starboard Shield Generator:** 8 HP, powers 15 HP shield
- **2x Impulse Engines:** 8 HP each, lose one = 2/3 speed, lose both = 0 speed
- **2x Warp Nacelles:** Charge warp drive over ~2 min, allows scenario exit when full
- **Main Energizer:** 12 HP, destroyed = ship explodes (anti-matter breach)
- **Bay:** 6 HP, holds 6 decoys/6 mines, 6-sec gap between releases, destroyed = no more deployment
- **Sensors:** 6 HP, damage reduces detection radius
- **Command & Control:** 6 HP, damage causes control input failures
- **Space Frame:** 12 HP, absorbs damage to already-destroyed systems, 0 HP = explosion

### Engine Performance by Ship Class
- **FG:** 1 impulse engine (0 HP = 0 speed)
- **CL:** 2 engines (lose 1 = 50% speed, lose 2 = 0 speed)
- **CA:** 2 engines (lose 1 = 67% speed, lose 2 = 0 speed)
- **BC:** 3 engines (lose 1 = 67%, lose 2 = 33%, lose 3 = 0 speed)

### Weapon Mechanics Detail
- **Beam Battery (Medium):**
  - 1 dmg/hit, 20 ship-length range
  - 3 shots in succession at 1 shot/second
  - 2 seconds after last shot, charging begins
  - Recharges 1/3 of bar per 2 seconds until full

- **Torpedo Launcher (Medium):**
  - 1 dmg to shields OR 1 dmg per system in 10% CA-length blast radius (hull hits)
  - 4 loaded/20 stored torpedoes
  - After 4 seconds of not firing, begins reload
  - Reloads 1 torpedo per 4 seconds until fully loaded

- **Torpedo Behavior:**
  - 6x ship speed, 4-sec lifespan
  - Fire-and-forget: retains lock even if ship loses lock-on
  - Homing when locked, straight-line when not locked
  - Can be shot down by beams (difficult - small & fast)

- **Lock-On System:**
  - 4 seconds to acquire (reticle spinning indicator)
  - Audio cue on successful lock
  - Allows reticle drift without breaking lock
  - Torpedo retains lock independently after firing

- **Shield Recovery:**
  - Each shield tracks damage independently
  - 5 seconds without THAT SPECIFIC shield being hit
  - Then recovers 1 HP/sec until full
  - Any hit to that shield stops recovery and resets 5-sec timer

- **Decoy/Mine Deployment:**
  - Bay holds 6 decoys and 6 mines
  - Spacebar tap = decoy, long-press = mine
  - 6-second cooldown between any deployments
  - Decoys last 10 seconds, mines persist until triggered
  - Bay destruction prevents further deployment

## Implementation Progress

### Phase 1: Core Engine & Rendering - COMPLETED ✓
**Files Created:**
- `index.html` - Main game page with HUD structure
- `css/main.css` - Global styles
- `css/hud.css` - HUD component styles
- `css/menus.css` - Menu screen styles
- `css/ui.css` - UI component styles
- `js/config.js` - Global configuration constants
- `js/utils/MathUtils.js` - Math utility functions
- `js/core/EventBus.js` - Event system
- `js/core/InputManager.js` - Keyboard/mouse input handling
- `js/core/Camera.js` - Camera/viewport system (player-centered)
- `js/core/StateManager.js` - Game state management
- `js/core/GameLoop.js` - Fixed timestep game loop (60 FPS)
- `js/core/Engine.js` - Main game engine
- `js/components/Transform.js` - Position/rotation/velocity component
- `js/entities/Entity.js` - Base entity class
- `js/entities/Ship.js` - Ship entity with faction-specific designs
- `js/rendering/Renderer.js` - Main renderer with starfield
- `js/rendering/ShipRenderer.js` - Vector graphics ship renderer
- `js/rendering/UIRenderer.js` - Minimap renderer
- `js/ui/HUD.js` - HUD manager
- `js/main.js` - Entry point

**Features Implemented:**
- ✓ 60 FPS game loop with fixed timestep
- ✓ Canvas rendering with responsive layout
- ✓ Player-centered camera (ship stays in center, world scrolls)
- ✓ Event-driven input system (WASD, mouse, spacebar)
- ✓ State management (menu, playing, paused)
- ✓ Vector ship rendering with faction-specific designs:
  - Galaxy-class (Player/Federation)
  - D-7 style (Trigon/Klingon)
  - Warbird style (Scintilian/Romulan)
  - Tholian diamond (Pirate)
- ✓ Newtonian and Non-Newtonian movement modes (toggle with Left Ctrl)
- ✓ Basic ship movement (thrust, turn)
- ✓ Starfield background with parallax
- ✓ HUD framework (tactical panel, minimap, reticle)
- ✓ Menu system (main menu, pause menu)
- ✓ Debug info display

**Current Status:**
- Local server running on http://localhost:8000
- Basic game is playable: click "New Game" to spawn player ship
- Ship moves with WASD controls
- Toggle movement mode with Left Ctrl
- ESC to pause/unpause

### Phase 2: Physics & Movement Systems - COMPLETED ✓
**Files Created:**
- `js/physics/PhysicsWorld.js` - planck.js wrapper with collision categories
- `js/physics/CollisionHandler.js` - Processes all collision types
- `js/physics/GravityWell.js` - Gravity system for collapsars
- `js/components/Physics.js` - Physics body component for entities
- `js/entities/Asteroid.js` - Asteroid with breaking mechanics
- `js/entities/Environmental.js` - Collapsars, dust clouds, planets
- `js/rendering/EnvironmentRenderer.js` - Renders environmental hazards

**Features Implemented:**
- ✓ planck.js (Box2D) physics integration
- ✓ Zero-gravity space physics with custom gravity wells
- ✓ Collision detection & response (bounce + damage)
- ✓ Ship-ship collisions
- ✓ Ship-asteroid collisions with asteroid breaking:
  - Large asteroids → 2 medium asteroids (3 damage)
  - Medium asteroids → 2 small asteroids (2 damage)
  - Small asteroids → destroyed (1 damage)
- ✓ Asteroid physics (dynamic velocity, rotation)
- ✓ Collapsar (black hole) with:
  - Gravity well with linear falloff
  - Swirling particle effects
  - Instant destruction on contact
- ✓ Dust clouds (particle-based, blocks beams - Phase 3)
- ✓ Planets (large static bodies, collision damage)
- ✓ Hull HP tracking with damage feedback
- ✓ Critical event log in HUD
- ✓ Game over on ship destruction

**Current Status:**
- Physics fully integrated into game loop
- 6 test asteroids spawning (2 large, 2 medium, 2 small)
- 1 collapsar with visible gravity well
- 1 dust cloud
- 1 planet
- Collision damage shows in HUD
- Asteroids break into smaller pieces on impact
- Player ship affected by collapsar gravity

### Phase 3: Combat & Weapons Systems - COMPLETED ✓
**Files Created:**
- `js/components/weapons/Weapon.js` - Base weapon component
- `js/components/weapons/BeamWeapon.js` - Beam weapon with 3-shot charge system
- `js/components/weapons/TorpedoLauncher.js` - Torpedo launcher with reload mechanics
- `js/entities/Projectile.js` - Base projectile + BeamProjectile + TorpedoProjectile
- `js/entities/Decoy.js` - Decoy entity with torpedo confusion
- `js/entities/Mine.js` - Mine entity with proximity trigger
- `js/systems/TargetingSystem.js` - Lock-on system (4-second acquisition)

**Features Implemented:**
- ✓ **Beam Weapons**:
  - 3-shot burst system (1 shot/second)
  - 2-second recharge delay after depletion
  - Recharges 1/3 of bar per 2 seconds
  - 270° firing arcs (forward/aft)
  - Very fast projectile speed
  - 20 ship-length range
  - Visual charge bars in HUD

- ✓ **Torpedo Launchers**:
  - 4 loaded / 20 stored per launcher
  - 90° firing arcs (forward/aft)
  - 4-second reload delay after last shot
  - Reloads 1 torpedo per 4 seconds
  - Fire-and-forget homing (retains lock even if ship loses it)
  - Terminal homing phase at halfway point
  - Can be shot down by beams (difficult)
  - Visual torpedo count in HUD

- ✓ **Targeting System**:
  - 4-second lock-on acquisition
  - Spinning reticle animation while locking
  - Red locked reticle when acquired
  - Lock-on audio cue
  - Drift tolerance (50px) maintains lock
  - Works on ships and asteroids

- ✓ **Decoys** (Spacebar tap):
  - 6 decoys per ship
  - 10-second lifetime
  - Pulsing visual effect
  - Confuses torpedoes (chance increases as torp gets closer)
  - Blocks beam weapons
  - 6-second deployment cooldown

- ✓ **Mines** (Spacebar long-press):
  - 6 mines per ship
  - Invisible to enemies (low detection radius)
  - 0.5-second arm delay
  - 10 damage on contact
  - Blinking danger indicator
  - 6-second deployment cooldown

- ✓ **Combat Integration**:
  - Left-click fires all beams in arc
  - Right-click fires all torpedoes in arc
  - Projectile collision detection
  - Projectile damage to ships/asteroids
  - Torpedoes break asteroids
  - Decoy confusion logic
  - Mine trigger detection
  - HUD shows live weapon status

**Current Status:**
- All weapons functional and integrated
- Targeting system tracks mouse and acquires locks
- Projectiles render with trails/effects
- Decoys and mines deploy and function
- HUD updates weapon charge, torpedo counts, decoy/mine counts
- Can destroy asteroids with weapons
- Ready for enemy AI weapons (Phase 5)

## Next Steps
1. Continue to Phase 4: Ship Systems & Damage Model
2. Or continue to Phase 5: AI & Enemy Behavior

## Faction-Specific Details

### Ship Designs
- **Player (Federation):** Galaxy-class Heavy Cruiser
- **Trigon (Klingon-style):** D-7 design (forward command pod, long neck, body with 1-3 impulse engines at back, two warp nacelles)
- **Scintilian (Romulan-style):** Warbird design (saucer-shaped with forward-swept nacelles)
- **Pirate (Tholian-style):** Asymmetrical diamond-like shapes

### Trigon Weapon Systems - Disruptors
- **Weapon Type:** Disruptors (not beams or torpedoes)
- **Mounting:** Front of warp nacelles + chin of forward pod
- **Firing Arc:** 120° forward arc (BC also has single aft 120° arc disruptor)
- **Recharge Time:** 2 seconds between shots
- **Damage:** 2 dmg/hit
- **Visual:** Wave effect moving at 2x torpedo speed
- **Lock-On:** No lock-on capability
- **Ship Performance:** Better turning circles and higher speeds than player equivalent ships
- **Shield Strength:** 2/3 of player equivalent shield strength

### Scintilian Weapon Systems & Abilities
- **Beam Weapons:** Standard beams but only 2 shots before recharge (vs player's 3 shots)
- **Cloaking Device:**
  - Can render ship invisible
  - No shields while cloaked
  - Cannot fire weapons until 5 seconds after decloaking
  - Must wait 30 seconds between cloaking/decloaking
  - Can still be hit while cloaked
  - Torpedoes cannot lock-on to cloaked ships
  - When hit while cloaked, briefly flash visible then fade back to invisible

- **Plasma Torpedoes:**
  - 1 plasma torpedo per launcher
  - Speed: 2/3 of player torpedo speed
  - Homing: Follows locked-on target
  - **Damage Potential (DP) System:**
    - Starts at 30 DP
    - Reduces by 1 DP per second in flight
    - Reduces by 1 DP per beam hit suffered
    - Reduces by 1 DP per torpedo hit suffered
  - **Damage Application:**
    - Full DP applied to shield
    - Then blast circle applied to hull
  - **Blast Radius Calculation:**
    - At 30 DP: 150% of target ship's longest dimension
    - Reduces by 5% per DP lost
    - At 10 DP: 50% of target ship's longest dimension
    - Formula: Radius = (Target longest dimension) × (0.50 + (DP × 0.05))

### Pirate Weapon Systems
- **Standard Equipment:** Use standard beam and torpedo weapons (player-style)
- **Design:** Asymmetrical diamond shapes (Tholian-inspired)

## Decisions Made
- Using Canvas 2D instead of Three.js (better fit for 2D retro vector graphics)
- planck.js for physics (Box2D port)
- Modular architecture: HTML structure, CSS styling, JS game logic
- Mission data in JSON format for easy editing
- Component-based ship rendering system
